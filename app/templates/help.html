{% extends "layout.html" %}	
{% block body %}
<div class="text_body">
	<h2>
        <a href="{{ url_for('create') }}">
            <img src = "{{ url_for('static', filename='create_field.svg') }}">
        </a>
		Register fields and trees
	</h2>
		<h3 id="locations">Locations</h3>
			<p>
                Countries, Regions and Farms provide location context for <a href="#fields">Fields</a>
                , a core component of the BreedCAFS data model. The Farm represents a large farm or research facility
				where multiple fields and/or growth environments are available.
			</p>
		<h3 id="fields">Fields</h3>
			<p>
				The Field represents a collection of <a href="#trees">Trees</a> under common non-experimental conditions.
                It is also the largest unit in the BreedCAFS data model to which records may be attributed.

                In a typical farm setting the Field will be a single field,
				although in BreedCAFS on-farm trials it may represent an entire small-holder farm.
				In research facilities with controlled growth environments, the Field will likely be a glasshouse
                or a collection of chambers.
			</p>
			<p>
                To facilitate the data submission and retrieval process,
				each Field is registered to a Farm and assigned a unique identifier (UID).
				For Fields this UID is an integer (e.g. "1") that increments with each additional field in the database.
			</p>
		<h3  id="blocks">Blocks</h3>
			<p>
				Blocked experimental designs are often necessary to account for conditions (nuisance factors) that vary
				within a given field. Similarly, in controlled growth experiments such variation is often found
				between growth chambers. To facilitate analyses in such experimental designs,
                <a href="#trees">Trees</a> can be optionally assigned to Blocks within a <a href="#fields">Field</a>.
			</p>
			<p>
				Blocks are assigned a UID that is incremented from the <a href="#fields">Field</a> UID.
				As an example, "1_B2" is the UID for the second block registered within the <a href="#fields">Field</a>
                with UID 1. Blocks are best added first so that subsequent <a href="#trees">Trees</a>
                may be registered directly into a Block.
                However, <a href="#trees">Trees</a> may be later assigned to a registered Block
                (must be in the same field) by recording the registered block name in the
                "Assign tree to block by name" property.
			</p>
		<h3 id="trees">Trees</h3>
			<p>
				Trees are registered within a <a href="#fields">Field</a> and optionally within a <a href="#blocks">Block</a>.
                Each Tree is assigned a UID that increments from the <a href="#fields">Field</a> UID.
				As an example, "1_T2" is the UID for the second tree registered within the <a href="#fields">Field</a> with UID 1.
			</p>
            <p>
                In registering Trees you are be provided a BreedCAFS template listing the Tree UIDs and allowing you
                to record details for later <a href="#upload">submission</a>. This same template can also be generated on the
                <a href="#record">Record</a> page by selecting the "Registration" input group.
            </p>
	<h2 id="samples">
        <a href="{{ url_for('collect') }}">
            <img src = "{{ url_for('static', filename='collect.svg') }}">
        </a>
		Register samples
	</h2>
        <p>
            The most common usage for Sample registration will be to represent phyiscal harvested specimens.
            However, samples can also be used to describe nested statistical sampling strategies.
        </p>
        <h3>
            Item level
        </h3>
            <p>
                If each sample represents a single registered item then select the level of this item.
                If each sample represents a group of items, then select the Field level
                and later associate each sample with the specific Block(s), Tree(s) or Sample(s)
                by recording the relevant property;
                "Assign field sample to block by name", "Assign field sample to block(s) by ID",
                "Assign field sample to tree(s) by ID" or
                "Assign field sample to sample(s) by ID"
            </p>
            <h4>
                Some examples to help clarify the distinction between levels
                for samples as either specimens or statistical units:
            </h4>
                <ul>
                    <li>
                        <p>
                            In the case of harvested specimens, a Field level sample would correspond to
                            tissue from the field for which the specific tree(s) identity is not known.
                        </p>
                        <p>
                            In the case of statistical sampling, a Field level sample similarly corresponds
                            to an identity to which other data may be associated. An example of this usage would be
                            in recording data from trees for which only the Field is known. The tree could be registered
                            as a sample and records for this tree associated with that sample.
                        </p>
                    </li>
                    <li>
                        A Block level sample can be used as for Field level samples, just that in this case the specific block
                        that was sampled is known.
                    </li>
                    <li><p>
                            In the case of a harvested specimen, a Tree level sample would correspond to tissue that
                            was harvested from a registered tree or trees, for which the identity of the trees is known.
                        </p>
                        <p>
                            In the case of statistical sampling, A Tree level sample similarly corresponds to an
                            identity to which other data may be associated. An example of this usage would be in
                            recording data from a branch. The branch could be registered as a sample and records
                            for this branch associated with that sample.
                        </p>
                    </li>
                    <li>
                        <p>
                            In the case of harvested specimens, Sample level sampling allow us to create sub-samples
                            with unique identities to use following splitting of a sample either into multiple
                            locations or following subdivision of tissues (e.g. separating cherry flesh from bean).
                        </p>
                        <p>
                            In the case of statistical sampling, A Sample level sample allows us to model more complex
                            statistical sampling strategies than would be supported by the more simple replicate codes.
                            For example, in the provided case where a tree is registered as a Field level sample,
                            further sub-samples could be created that represent individual branches of that tree.
                        </p>
                    </li>
                </ul>
        <h3>
            Filters
        </h3>
            <p>
                The filters allow you to select specific items to sample (Fields/Trees/Samples).
                Your selection here will update the <a href="#selection">selection</a> below.
            </p>
        <h3 id="selection">
            Selection
        </h3>
            <p>
                Here you can see the number of items selected to sample.
            </p>
            <p>
                You can then optionally specify the number of samples to register per item (default is 1).
            </p>
            <p>
                When you register samples you are provided a BreedCAFS template detailing the sample UIDs
                and allowing you to record details for later <a href="#upload">submission</a>.
                This same template can also be generated on the
                <a href="#record">Record</a> page by selecting the appropriate "Registration" input group.
            </p>
    <h2 id="record">
        <a href="{{ url_for('record') }}">
            <img src = "{{ url_for('static', filename='record.svg') }}">
        </a>
        Record data
    </h2>
        <p>
            This page allows users to <!--either <a href="#direct">directly submit</a> records or-->
            generate templates to record data in <a href="#spreadsheet">spreadsheet software</a> such as Microsoft Excel,
            or alternatively generate files required for the <a href="#field book">Field Book</a> application.
        </p>
        <p>
            Templates you have already generated can be found through the
            <a href="{{  url_for('download') }}">download page</a> among your
            <a href="{{  url_for('download_files') }}">generated files</a>
        </p>
        <h3>
            Items
        </h3>
        <p>
            To record data the first step is to filter for items for which you intend to submit records.
            The type of item, be it <a href="#fields">Field</a>, <a href="#trees">Tree</a>
            or <a href="#samples">Sample</a>, will determine the subsequent options that are available.
        </p>
        <p>
            With the item type selected, use the location and ID filters to narrow down to the desired items.
            The number of items selected is displayed under "Selection".
        </p>
        <h3>
            Input variables
        </h3>
        <p>
            Once you have established your selection of items, you may now select the variables
            for which you intend to record data. Input variables fall into four supported record types,
            <a href="#properties">Properties</a>,
            <a href="#traits">Traits</a>,
            <a href="#curves">Curves</a> and
            <a href="#conditions">Conditions</a>.
        <p>
            Input variables are further organised into groups to facilitate selection (even across multiple record types).
            Select a group and then chose from among the variables in that group.
            If the group of variables you would like to select is not available then please contact an admin
            to create a new group.
        </p>
        {% if ('global_admin' in session.access) or ('partner_admin' in session.access) %}
        <h3>
            Manage input groups
        </h3>
            <p>
                Your users will only have access to the groups that you or another admin for your partner
                have created through the
                <a href="{{  url_for('input_group_management') }}">input group management page</a>.
                This limitation is designed to prevent confusion between teams with different roles.
            </p>
            <h4>
                Create an input group
            </h4>
                <p>
                    If you wish to start by modifying a copy of an existing group then either select a partner
                    from whom to copy or select "Default variable groups".
                </p>
                <p>
                    Select the group to copy or leave this blank to create an empty group.
                </p>
                <p>
                    Enter a name for the group in the text field and click '+' to add the group.
                </p>
            <h4>
                Manage group members
            </h4>
                <p>
                    Select the group to manage and drag input variables from the "Find input variables" box into the
                    box below.
                </p>
            <h4>
                <p>
                    Input variables may be relevant to multiple levels of items,
                    so it is necessary to further specify the levels of relevance for the group.
                </p>
            </h4>
        {% endif %}

        <h3 id="spreadsheet">Spreadsheet software</h3>
            <p>
                In most cases users are familiar with <a href="#spreadsheet">spreadsheet table templates</a>
                for data collection.
                In BreedCAFS templates the input variables are split into a worksheet per record type
                and a worksheet per variable for curve type variables.
                Additional worksheets are provided with details about the item (Item Details) and input variables (Input Variable Details).
            </p>
            <p>
                If you are aggregating data from multiple periods of recording you may want a table that contains
                rows for multiple records per selected item.
                For convenience, the number of duplicated rows per item can be set by the "time points" value.
            </p>
            <p>
                To generate spreadsheet table templates for the selected items and input variables,
                simply select "Table (xlsx)" in the drop down box (selected by default)
                and click "Generate template".
            </p>
       <!-- <h3 id="direct">Direct submission</h3>
            <p>
                To easily make direct submissions of a single value for a set of items a web-form is provided.
                Please ensure you have carefully selected the items as the same value will be recorded for the entire selection.
            </p>
            <p>
                Currently, to make a <a href="#direct">direct submission</a> the record type must be selected
                and curves are not supported.
            </p>
            <p>
                With items, input variables and record type selected, simply enter values for all selected input variables and click submit.
                You will receive a report in the browser window that will either confirm your submission or warn of errors and/or conflicts.
            </p>-->
        <h3 id = "field book">Field Book application</h3>
            <p>
                The Field Book application is designed to support data collection for simple traits.
                To facilitate the use of this application the database tools site can generate the required input files;
                "traits.trt" and "fields.csv". More detailed instructions on using Field Book application are available
                <a href=" {{  url_for('field_book_help') }}">here</a>
            </p>
            <p>
                To generate the Field Book input files the "Trait" record type must be selected.
            </p>
            <p>
                With items, input variables and record type selected, simply select "Field Book (csv)"
                in the drop down box and click "Generate template".
            </p>
        <h3>Record Types</h3>
        <h4 id="properties">Properties</h4>
            <p>
                Properties have a single value for each item. These include "variety name" and "planting date".
            </p>
        <h4 id="traits">Traits</h4>
            <p>
                Traits have a single (or <a href="replicates">replicated</a>) value for each item  at an assessed time point.
            </p>
        <h4 id="curves">Curves</h4>
            <p>
                Curves have a paired list of independent ("X") and dependent ("Y") variables
                (that may be <a href="replicates">replicated</a>) for each item at an assessed time point.
            </p>
            <p>
                The templates for curve input variables are generated as a worksheet for each input variable.
                These worksheets will include column headers for the required (UID, Date) and optional (Time, Person) details
                while the rest of the worksheet is left blank. To input data into these worksheets, simply include the "X" value
                as a column header and the "Y" value in the corresponding row. Both "X" and "Y" values must be floating point numbers.
            </p>
        <h4 id="conditions">Conditions</h4>
            <p>
                Conditions have a single (or <a href="replicates">replicated</a>) value for any given period.
                The start and end time of this period are optionally defined in each record,
                however the following rules apply:
                <ul>
                    <li>
                        If a condition is set without bounds (i.e. without start or end) then no differing
                        record will be accepted.
                    </li>
                    <li>
                        If a single bound is set (start or end) then no differing record
                        with an opposite bound (i.e. end or start respectively)
                        will be accepted in the unbounded direction (later or earlier respectively) .
                    </li>
                    <li>
                        Fully bound records (preferred) will not be accepted
                        where they differ with any record that has an overlapping period.
                    </li>
                </ul>
            </p>
            <p>
                These rules can lead to a situation where to set a new value for an unbounded condition,
                an existing record must be <a href="#correct">deleted</a>.
                Be sure that new bounded conditions are set to replace these delete record!
            </p>
        <h3>Replicates</h3>
            <p>
                For trait, condition, and curve data, replicate codes may be used to submit multiple records for
                a single input variable at a given time or period for the same item.
            </p>
            <p>
                Replicate codes are simple integers appended to a UID, e.g. "1_T1.1" would be the first replicate for
                Tree "1_T1".
            </p>
            <p>
                Replicate codes are also considered in establishing simple identities for statistical analyses.
                That is to say, if a record for a trait or curve input variable is submitted with a replicate code
                then all other trait or curve records at that time for that item and with that replicate code
                should be associated with the same sampling event. For conditions records, all trait/curve/condition
                records associated with that item and replicate code in that period should be associated with that condition.
            </p>
            <p>
                Further, when no replicate code (or a replicate code of '0') is associated with any trait/curve/conditon
                record, then this record should be representative for all records (replicated or not) for that item,
                at that time or in that period.
            </p>
            <p>Where more complex sampling procedures are needed
                <b>
                    or there is a risk of users submitting records for the same items for the same time or period
                    with un-associated but identical replicate codes
                </b>
                then identities should be made more explicit by registering <a href="samples">Samples</a>.
            </p>
            <p>
                <b>
                    <!--NB: I have yet to develop a warning system for this but it should be possible upon submission to
                    provide an opportunity for users to confirm that the records they are submitting
                    are associated with any existing replicate codes in use at that time/period.
                    The user could be presented with the name of the user/partner
                    that first used these codes to help inform them of the decision.
                    This may be challenging though as cases may be expected
                    where separate groups at first are using the same replicate codes at distinct times
                    but later a condition record may be submitted for a spanning period. This would need to addressed
                    by changing replicate codes and/or fragmenting the condition record(s).-->
                </b>
            </p>
    <h2 id="upload">
        <a href="{{ url_for('upload') }}">
            <img src = "{{ url_for('static', filename='upload.svg') }}">
        </a>
        Upload data
    </h2>
        <p>
            This is the portal to submit templates and exported data from Field Book.
            A simple graphic is displayed to provide immediate feedback on the submission process.
        </p>
        <p>
            For <a href="#spreadsheet">table templates</a> simply select "Table (xlsx, csv)" in the drop down menu
            then either drag and drop your file onto the icon below
            or click the icon to use your browser to select a file to upload.
        </p>
        <p>
            You will be given feedback about the upload process and a report either confirming the submission or
            alerting you of any errors will be returned.
        </p>
        <p>
            Once the upload itself is complete you will be notified that the file is being checked.
            At this stage you may navigate away from the page if desired.
            An email will be sent detailing the outcome of your submission.
        </p>
        <p>
            In these reports, frequently a table is returned, detailing the line number containing the error.
            If there are highlighted cells in these tables
            simply hover the mouse over the cell to see more details about the error.
        </p>
	<h2 id="download">
		<a href="{{ url_for('download') }}">
			<img src = "{{ url_for('static', filename='download_espresso.svg') }}">
		</a>
		Retrieve data
	</h2>
		<p>
			Retrieve data submitted by your affiliated partners, filtering by location and time period.
			First select a level of data to retrieve (field/block/tree/branch/leaf or sample)
			Then further select specific traits
		</p>
		<p>
			Both database format (single row per item/time/trait) and table format (single row per item)
			are provided.
			The database format contains additional information about who submitted the data (user and partner)
			as well as when, where and by whom (if using Field Book) this data was collected.
			The table format may be useful in simple cases although please note:
			when multiple data points are found for a single trait, these will be returned
			as a list within a single cell of the table.
		</p>
    <h2 id="correct">
        <a href=""{{ url_for('correct') }}>
            <img src="{{ url_for('static', filename='correct.svg') }}">
        </a>
        Delete records
    </h2>
        <p>
            To delete records (and revert property changes) you need to upload a file containing the specific records
            you want to delete through the <a href="{{ url_for('correct') }}">correct</a> portal.
        </p>
        <p>
            If you just uploaded the records and you want to delete the entire submission then the submission report file is suitable.
            Otherwise generate a "database" format file on the download page using appropriate filters to include only the records you want to delete.
            You may also manually remove rows from this generated file if you can't find all the appropriate filters.
            With this file now describing the records you want to delete, simply upload the file on the <a href=""{{ url_for('correct') }}>correct</a> page.
        </p>
        <p>
            Partner admins are able to delete records submitted by all members of their institute.
            Other users are only be able to delete their own records.
            If your report implies that the records cannot be found despite you being able to access these records
            through the download page then you may need to contact the relevant partner admin to have these records deleted.
        </p>
	<h2>
        <a href="{{ url_for('user_page') }}">
            <img src = "{{ url_for('static', filename='user.svg') }}">
        </a>
		Manage your account
	</h2>
		<p> This page allows you to select and see the status of your affiliations
			that provide access to submitted data.
		</p>
		<p>
			Your primary affiliation (marked with a *) is the partner you selected during registration.
			This affiliation may not be removed and all data you submit will be accessible
			to users with confirmed affiliations to this partner.
		</p>
		<p>
			You may request/remove additional affiliations with this form by selecting the relevant partners
			then clicking 'Add/remove affiliations'.
			The partner administrator (see below) can then confirm this affiliation,
			providing access to data submitted by users that registered with this institute
			(i.e. have this as their primary affiliation).
		<p><i>Partner administrator access is granted by a Global Administrator.</i></p>
	{% if ('global_admin' in session.access) or ('partner_admin' in session.access) %}
	<h2>
		<a href="{{ url_for('admin') }}">
            <img src = "{{ url_for('static', filename='admin.svg') }}">
        </a>
        Manage your team
	</h2>
		<p>
			Only administrators have access to this page.
			Here you can add new emails to the authorised list, allowing registration by new team members.
			You can also confirm/unconfirm registered users,
			providing/denying access to the data through the download portal.
		</p>
    {% endif %}
	</div>





{% endblock %}
