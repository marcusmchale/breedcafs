{% extends "layout.html" %}	
{% block body %}
<div class="text_body">
	<h2>
        <a href="{{ url_for('create') }}">
            <img src = "{{ url_for('static', filename='create_field.svg') }}">
        </a>
		Register fields and trees
	</h2>
		<h3 id="locations">Locations</h3>
			<p>
                Countries, Regions and Farms provide location context for <a href="#fields">Fields</a>
                , a core component of the BreedCAFS data model. The Farm represents a large farm or research facility
				where multiple fields and/or growth environments are available.
			</p>
		<h3 id="fields">Fields</h3>
			<p>
				The Field represents a collection of <a href="#trees">Trees</a> under common non-experimental conditions.
                It is also the largest unit in the BreedCAFS data model to which records may be attributed.

                In a typical farm setting the Field will be a single field,
				although in BreedCAFS on-farm trials it may represent an entire small-holder farm.
				In research facilities with controlled growth environments, the Field will likely be a glasshouse
                or a collection of chambers.
			</p>
			<p>
                To facilitate the data submission and retrieval process,
				each Field is registered to a Farm and assigned a unique identifier (UID).
				For Fields this UID is an integer (e.g. "1") that increments with each additional field in the database.
			</p>
		<h3  id="blocks">Blocks</h3>
			<p>
				Blocked experimental designs are often necessary to account for conditions (nuisance factors) that vary
				within a given field. Similarly, in controlled growth experiments such variation is often found
				between growth chambers. To facilitate analyses in such experimental designs,
                <a href="#trees">Trees</a> and <a href="#samples">Samples</a> can be optionally assigned to Blocks within a <a href="#fields">Field</a>.
			</p>
			<p>
				Blocks are assigned a UID that is incremented from the <a href="#fields">Field</a> UID.
				As an example, "1_B2" is the UID for the second block registered within the <a href="#fields">Field</a>
                with UID 1. Blocks are best added first so that subsequent items
                may be registered directly into the corresponding Block. However, items may be later assigned to a registered Block
                (must be in the same field) by submitting a record for one of the
                "Assign...to block..." properties.
			</p>
		<h3 id="trees">Trees</h3>
			<p>
				Trees are registered within a <a href="#fields">Field</a> and optionally within a <a href="#blocks">Block</a>.
                Each Tree is assigned a UID that increments from the <a href="#fields">Field</a> UID.
				As an example, "1_T2" is the UID for the second tree registered within the <a href="#fields">Field</a> with UID 1.
			</p>
            <p>
                In registering Trees you are provided a BreedCAFS template listing the Tree UIDs. This template is provided to help you
                record details for later <a href="#upload">submission</a>. This same template can however also be generated on the
                <a href="#record">Record</a> page by selecting the "Registration" input group.
            </p>
	<h2 id="samples">
        <a href="{{ url_for('collect') }}">
            <img src = "{{ url_for('static', filename='collect.svg') }}">
        </a>
		Register samples
	</h2>
        <h3>
            Sampling activity
        </h3>
            <p>
                The most common usage for Sample registration will be to represent physical harvested specimens
                either during harvest or during subsequent handling and distribution.
                However, samples may also represent 'in situ' sampling events in more complex sampling designs
                that can not be represented by the core Field/Block/Tree sampling structure (examples below).
            </p>
            <p>
                Selecting the sampling activity filters the available selections
                and ensures you are provided with a relevant registration template following sample registration.
            </p>
        <h3>
            Sampled items
        </h3>
            <p>
                To register samples you must first select a registered item from which you are sampling.
            </p>
            <p>

            </p>
            <h4>
                Item level
            </h4>
                <p>
                    Here you should select the relevant level from which you are sampling .
                    If each sample is taken from a single registered item then you can directly select this item.
                    However, where each sample is a collection taken from multiple registered items
                    you need to first register the samples against a parent item from which this collection was taken (e.g. the Field).
                    You can then later specify the specific collection of source items for each sample
                    by submitting a list of IDs for one of the "Assign sample to ...(s) ..." properties.
                </p>
                <p>
                    Your selection for "Item level" will update the available filters for items below.
                </p>
            <h4>
                Item/s
            </h4>
                <p>
                    These filters allow you to select specific items to sample at the selected level.
                    For Field and Block you can either use the drop down boxes or enter a list of IDs.
                </p>
                <p>
                    Your selection for "Item level" will update the <a href="#item_count">item count</a> below.
                    Press return when entering specific ID's into the text boxes to ensure the item count is updated.
                </p>
            <h4 id="item_count">
                Item count
            </h4>
                <p>
                    Here you can see the number of items selected to sample.
                    You can then optionally specify the number of samples to register per item (default is 1).
                    For example, if you wanted to register 5 samples from 2 fields you would ensure that
                    the item count is 2 and then enter 5 in the text-box.
                </p>
                <p>
                    When you register samples you are provided a BreedCAFS template detailing the sample UIDs.
                    This allows you to record details for later <a href="#upload">submission</a>.
                    This same template can also be generated on the
                    <a href="#record">Record</a> page by selecting the appropriate "Registration" input group.
                </p>
        <h3>
            Sampling examples
        </h3>
           <p>
                A Field level sample corresponds to an entity (or collection of entities) from a registered Field
                for which a specific block/tree/sample identity is not specified.
                In the case of harvested specimens each sample may represent for example,
                a given tissue from a randomly selected tree or collection of trees.
                In the case of 'in situ' sampling each sample may represent for example,
                a randomly selected tree or collection of trees from which a specific trait was measured.
            </p>
            <p>
                A Block level sample is similar to the Field level sample,
                just that here the initial sampling was conducted within known blocks.
            </p>
            <p>
                A Tree level sample corresponds to a tissue(s) or other delimited part(s)
                of a registered tree (or collection of specified registered trees).
                In the case of harvested specimens this could be as simple as a leaf from a single tree
                or a volume of cherries harvested from a number of specified trees.
                In the case of 'in situ' sampling, each sample could represent a randomly selected branch
                from which a trait was measured.
            </p>
            <p>
                Sample level samples (sub-samples) allow us to represent both the subdivision of physical specimens
                and more complex sampling strategies than can be represented with the simple Field/Block/Tree/Sample identities.
            </p>
            <p>
                For physical specimens, sub-samples represent a part of a divided specimen
                or a modified form of the original sample.
                For example:
            </p>
                <li> The divided fruit and bean tissues from a cherry sample can each be registered as a distinct sub-sample.</li>
                <li> The divided of a volumes of a given tissue to be distributed into different facilities or storage environments
                    can each be registered as distinct sub-samples.</li>
                <li> A processed form of a specimen, such as roasted beans, can equally be registered as a sub-sample from the original specimen</li>
            <p>
                For complex 'in situ' sampling strategies the sample represents
                a sampling event from within the registered sample.
                For example, using sub-samples we can register a design in which
                randomly selected trees were selected from a Field (Field level samples) and then
                from each such tree a given trait was measured from a number of randomly selected branches (Sample level samples).
            </p>


    <h2 id="record">
        <a href="{{ url_for('record') }}">
            <img src = "{{ url_for('static', filename='record.svg') }}">
        </a>
        Record data
    </h2>
        <p>
            This page allows users to <!--either <a href="#direct">directly submit</a> records or-->
            generate templates to record data in <a href="#spreadsheet">spreadsheet software</a> such as Microsoft Excel.
        </p>
        <p>
            Templates you have already generated can be found through the
            <a href="{{  url_for('download') }}">download page</a> among your
            <a href="{{  url_for('download_files') }}">generated files</a>
        </p>
        <h3>
            Items
        </h3>
        <p>
            To record data the first step is to filter for items for which you intend to submit records.
            The type of item, be it <a href="#fields">Field</a>, <a href="#trees">Tree</a>
            or <a href="#samples">Sample</a>, will determine the subsequent options that are available.
        </p>
        <p>
            With the item type selected, use the location and ID filters to narrow down to the desired items.
            The number of items selected is displayed under "Selection".
        </p>
        <h3>
            Input variables
        </h3>
        <p>
            Once you have established your selection of items, you may now select the variables
            for which you intend to record data. Input variables fall into four supported record types,
            <a href="#properties">Properties</a>,
            <a href="#traits">Traits</a>,
            <a href="#curves">Curves</a> and
            <a href="#conditions">Conditions</a>.
        <p>
            Input variables are further organised into groups to facilitate selection (even across multiple record types).
            Select a group and then chose from among the variables in that group.
            If the group of variables you would like to select is not available then please contact an admin
            to create a new group.
        </p>
        {% if ('global_admin' in session.access) or ('partner_admin' in session.access) %}
        <h3>
            Manage input groups
        </h3>
            <p>
                Your users will only have access to the groups that you or another admin for your partner
                have created through the
                <a href="{{  url_for('input_group_management') }}">input group management page</a>.
                This limitation is designed to prevent confusion between teams with different roles.
            </p>
            <h4>
                Create an input group
            </h4>
                <p>
                    If you wish to start by modifying a copy of an existing group then either select a partner
                    from whom to copy or select "Default variable groups".
                </p>
                <p>
                    Select the group to copy or leave this blank to create an empty group.
                </p>
                <p>
                    Enter a name for the group in the text field and click '+' to add the group.
                </p>
            <h4>
                Manage group members
            </h4>
                <p>
                    Select the group to manage and drag input variables from the "Find input variables" box into the
                    box below.
                </p>
            <h4>
                <p>
                    Input variables may be relevant to multiple levels of items,
                    so it is necessary to further specify the levels of relevance for the group.
                </p>
            </h4>
        {% endif %}

        <h3 id="spreadsheet">Spreadsheet software</h3>
            <p>
                In most cases users are familiar with <a href="#spreadsheet">spreadsheet table templates</a>
                for data collection.
                In BreedCAFS templates the input variables are split into a worksheet per record type
                and a worksheet per variable for curve type variables.
                Additional worksheets are provided with details about the item (Item Details) and input variables (Input Variable Details).
            </p>
            <p>
                If you are aggregating data from multiple periods of recording you may want a table that contains
                rows for multiple records per selected item.
                For convenience, the number of duplicated rows per item can be set by the "time points" value.
            </p>
            <p>
                To generate spreadsheet table templates for the selected items and input variables,
                simply select "Table (xlsx)" in the drop down box (selected by default)
                and click "Generate template".
            </p>
        <h3>Record Types</h3>
        <h4 id="properties">Properties</h4>
            <p>
                Properties have a single value for each item. These include "variety name" and "planting date".
            </p>
        <h4 id="traits">Traits</h4>
            <p>
                Traits have a single (or <a href="replicates">replicated</a>) value for each item  at an assessed time point.
            </p>
        <h4 id="curves">Curves</h4>
            <p>
                Curves have a paired list of independent ("X") and dependent ("Y") variables
                (that may be <a href="replicates">replicated</a>) for each item at an assessed time point.
            </p>
            <p>
                The templates for curve input variables are generated as a worksheet for each input variable.
                These worksheets will include column headers for the required (UID, Date) and optional (Time, Person) details
                while the rest of the worksheet is left blank. To input data into these worksheets, simply include the "X" value
                as a column header and the "Y" value in the corresponding row. Both "X" and "Y" values must be floating point numbers.
            </p>
        <h4 id="conditions">Conditions</h4>
            <p>
                Conditions have a single (or <a href="replicates">replicated</a>) value for any given period.
                The start and end time of this period are optionally defined in each record,
                however the following rules apply:
                <ul>
                    <li>
                        If a condition is set without bounds (i.e. without start or end) then no differing
                        record will be accepted.
                    </li>
                    <li>
                        If a single bound is set (start or end) then no differing record
                        with an opposite bound (i.e. end or start respectively)
                        will be accepted in the unbounded direction (later or earlier respectively) .
                    </li>
                    <li>
                        Fully bound records (preferred) will not be accepted
                        where they differ with any record that has an overlapping period.
                    </li>
                </ul>
            </p>
            <p>
                These rules can lead to a situation where to set a new value for an unbounded condition,
                an existing record must be <a href="#correct">deleted</a>.
                Be sure that new bounded conditions are set to replace these delete record!
            </p>
        <h3>Replicates</h3>
            <p>
                For trait, condition, and curve data, replicate codes may be used to submit multiple records for
                a single input variable at a given time or period for the same item.
            </p>
            <p>
                Replicate codes are simple integers appended to a UID, e.g. "1_T1.1" would be the first replicate for
                Tree "1_T1".
            </p>
            <p>
                Replicate codes are also considered in establishing simple identities for statistical analyses.
                That is to say, if a record for a trait or curve input variable is submitted with a replicate code
                then all other trait or curve records at that time for that item and with that replicate code
                should be associated with the same sampling event. For conditions records, all trait/curve/condition
                records associated with that item and replicate code in that period should be associated with that condition.
            </p>
            <p>
                Further, when no replicate code (or a replicate code of '0') is associated with any trait/curve/conditon
                record, then this record should be representative for all records (replicated or not) for that item,
                at that time or in that period.
            </p>
            <p>Where more complex sampling procedures are needed
                <b>
                    or there is a risk of users submitting records for the same items for the same time or period
                    with un-associated but identical replicate codes
                </b>
                then identities should be made more explicit by registering <a href="samples">Samples</a>.
            </p>
            <p>
                <b>
                    <!--NB: I have yet to develop a warning system for this but it should be possible upon submission to
                    provide an opportunity for users to confirm that the records they are submitting
                    are associated with any existing replicate codes in use at that time/period.
                    The user could be presented with the name of the user/partner
                    that first used these codes to help inform them of the decision.
                    This may be challenging though as cases may be expected
                    where separate groups at first are using the same replicate codes at distinct times
                    but later a condition record may be submitted for a spanning period. This would need to addressed
                    by changing replicate codes and/or fragmenting the condition record(s).-->
                </b>
            </p>
    <h2 id="upload">
        <a href="{{ url_for('upload') }}">
            <img src = "{{ url_for('static', filename='upload.svg') }}">
        </a>
        Upload data
    </h2>
        <p>
            This is the portal to submit templates.
            A simple graphic is displayed to provide immediate feedback on the submission process.
        </p>
        <p>
            For <a href="#spreadsheet">table templates</a> simply select "Table (xlsx, csv)" in the drop down menu
            then either drag and drop your file onto the icon below
            or click the icon to use your browser to select a file to upload.
        </p>
        <p>
            You will be given feedback about the upload process and a report either confirming the submission or
            alerting you of any errors will be returned.
        </p>
        <p>
            Once the upload itself is complete you will be notified that the file is being checked.
            At this stage you may navigate away from the page if desired.
            An email will be sent detailing the outcome of your submission.
        </p>
        <p>
            In these reports, frequently a table is returned, detailing the line number containing the error.
            If there are highlighted cells in these tables
            simply hover the mouse over the cell to see more details about the error.
        </p>
	<h2 id="download">
		<a href="{{ url_for('download') }}">
			<img src = "{{ url_for('static', filename='download_espresso.svg') }}">
		</a>
		Retrieve data
	</h2>
		<p>
			Retrieve data submitted by your affiliated partners, filtering by location and time period.
			First select a level of data to retrieve (field/block/tree/branch/leaf or sample)
			Then further select specific traits
		</p>
		<p>
			Both database format (single row per item/time/trait) and table format (single row per item)
			are provided.
			The database format contains additional information about who submitted the data (user and partner)
			as well as when, where and by whom this data was collected (if "person" was recorded for this record).
			The table format may be useful in simple cases although please note:
			when multiple data points are found for a single trait, these will be returned
			as a list within a single cell of the table.
		</p>
    <h2 id="correct">
        <a href=""{{ url_for('correct') }}>
            <img src="{{ url_for('static', filename='correct.svg') }}">
        </a>
        Delete records
    </h2>
        <p>
            To delete records (and revert property changes) you need to upload a file containing the specific records
            you want to delete through the <a href="{{ url_for('correct') }}">correct</a> portal.
        </p>
        <p>
            If you just uploaded the records and you want to delete the entire submission then the submission report file is suitable.
            Otherwise generate a "database" format file on the download page using appropriate filters to include only the records you want to delete.
            You may also manually remove rows from this generated file if you can't find all the appropriate filters.
            With this file now describing the records you want to delete, simply upload the file on the <a href=""{{ url_for('correct') }}>correct</a> page.
        </p>
        <p>
            Partner admins are able to delete records submitted by all members of their institute.
            Other users are only be able to delete their own records.
            If your report implies that the records cannot be found despite you being able to access these records
            through the download page then you may need to contact the relevant partner admin to have these records deleted.
        </p>
	<h2>
        <a href="{{ url_for('user_page') }}">
            <img src = "{{ url_for('static', filename='user.svg') }}">
        </a>
		Manage your account
	</h2>
		<p> This page allows you to select and see the status of your affiliations
			that provide access to submitted data.
		</p>
		<p>
			Your primary affiliation (marked with a *) is the partner you selected during registration.
			This affiliation may not be removed and all data you submit will be accessible
			to users with confirmed affiliations to this partner.
		</p>
		<p>
			You may request/remove additional affiliations with this form by selecting the relevant partners
			then clicking 'Add/remove affiliations'.
			The partner administrator (see below) can then confirm this affiliation,
			providing access to data submitted by users that registered with this institute
			(i.e. have this as their primary affiliation).
		<p><i>Partner administrator access is granted by a Global Administrator.</i></p>
	{% if ('global_admin' in session.access) or ('partner_admin' in session.access) %}
	<h2>
		<a href="{{ url_for('admin') }}">
            <img src = "{{ url_for('static', filename='admin.svg') }}">
        </a>
        Manage your team
	</h2>
		<p>
			Only administrators have access to this page.
			Here you can add new emails to the authorised list, allowing registration by new team members.
			You can also confirm/unconfirm registered users,
			providing/denying access to the data through the download portal.
		</p>
    {% endif %}
	</div>





{% endblock %}
